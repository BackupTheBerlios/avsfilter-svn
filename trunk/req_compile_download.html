<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>How to work. Requirements to use. Compile instructions. Download.</title>
  </head>
  <body>

<A name="how_to_work">
<h1>How to work</h1></A>
<hr>
<strong>Initialize stage</strong>
<p>At the stage of video filter initialization, each copy of avsfilter start wine separately with corresponding arguments - path/filename to avsload.exe and script name. Avsload.exe is being started by wine, gets wine path to temporary filenames and generates temporary pipe names. Pipe pathnames are printed to stdout. Avsfilter reads this names, converts wine-like pathnames to Linux-like pathnames, creates fifo's and opens pipe's. Avsload.exe loads avisynth.dll, pipe_source.dll and sends script name to avisynth.dll. Avsfilter sends clip parameters to pipe_source.dll and reads output clip parameters from avisynth.dll/avsload.exe.</p>
<strong>Work stage</strong>
<p>Avsfilter (function <em>getFrameNumberNoAlloc</em>) sends command (via communication pipe) to avsload.exe for getting filtered frame, avsload.exe calls avisynth.dll for getting filtered frame. Pipe_source.dll calls avsfilter for getting source frame (or several frames in the case temporal denoiser/framerate convertor/etc). Avisynth.dll makes frame from filters chain and returns them to avsload.exe Avsload.exe returns frame to avsfilter. </p>
<IMG src="pic/schemes2.png" alt="Data workflow diagram" width="611" height="365" align="top" border="0">
<p><strong>Script modify note</strong></p>
<p>Each avisynth script must be used PipeSorce() instead of AVISource()/MpegSource() etc. It needs for getting frame data from avidemux2/avsfilter to avisynth script entity. You can use several alternate video sources in script with various combination, but use PipeSource() is important. Each alternate video sources must be free from audio part (use AVISource().KillAudio() etc) <strong>because AvsFilter is Video Filter</strong>. PipeSource() not contain audio part.</p>
<p><strong>Multisource note</strong></p>
<p>Each avisynth script allows to use multiple sources, such as PipeSource() (main avidemux2 stream, which loaded), AVISource(), MPEGSource(), BlankClip(), MessageClip() and so on, load directly from script (these sources need installed directshow codecs, such as ffdshow.exe).</p>
<IMG src="pic/multiple_sources.png" alt="Multiple sources diagram" width="1047" height="718" align="top" border="0">
<A name="requirements">
<h1>Requirements to work</h1></A>
<hr>
<ol>
   <li><A href="http://www.winehq.org/site/download">Download</A> and compile wine or install it from binary rpm/etc.  </li>
   <li><A href="http://sourceforge.net/project/showfiles.php?group_id=57023">Download</A> and install avisynth.dll:<br>
       <p># wine Avisynth_257.exe</p>  </li>
   <li>Check avisynth correct install with help <A href="http://akuvian.org/src/avisynth/avs2yuv/">avs2yuv</A></li>
   <li><A href="http://fixounet.free.fr/avidemux/download.html">Download</A> and compile or install avidemux2</li>
 </ol>

<p><em><strong>Note :</strong></em> To store avsfilter parameters, need applying patch of file "prefs.in" and full recompile of avidemux2 sources. Not patched version of avidemux2 don't store our parameters, and every inserting avsfilter into filter list query pathnames to avsload.exe and avs script. For recompile avidemux2, <strong>you must be create new  dir for avidemux2 sources</strong>, copy avidemux2 sources from original tar.bz2, patching "prefs.in" and start ./configure and so on. <strong>Do not reuse already compiled or configured sources, because prefs.h and prefs.cpp not recreate after patching and therefore, unchanged.</strong></p>

<A name="compile_section">
<h1>How to compile</h1></A>
<hr>

<p>Requrements for linux compile [avsfilter.so]:</p>
<ul><li>avidemux2 sources.</li></ul>

<p>Requrements for wine part compile [pipe_source.dll, avsload.exe]:</p>
<ul>
   <li>msvc compiler;  </li>
   <li>wine;  </li>
   <li>avisynth sources. </li>
 </ul>

<h2>Compile linux sources [avsfilter.so] :</h2>

<p>The simplest way to compile this package is:</p>
<ol>
  <li><p>Unpack filterXXX.tar.bz2 and go to linux directory.</li></p>
  <li><p>Edit variables <strong>RELEASEDIR</strong> and <strong>AVIDEMUXSRCDIR</strong> in <em><strong>Makefile</strong></em>. <strong>RELEASEDIR</strong> is directory for external avidemux2 filters (usually /home/.../Xfilters), but you can save this filters in any directory. This directory must be set from "Preferences" submenu in avidemux2 to the same (as in <em><strong>Makefile</strong></em>) value. <strong>AVIDEMUXSRCDIR</strong> is directory with avidemux2 sources. If you are using avidemux2 from rpm/other binary packages, you can install sources of avidemux2 from corresponding srpm.</p></li>
  <li><p>If you compile avidemux2 from sources, need full recompile avidemux2. Create new directory and copy the avidemux2 sources into this dir. Also copy patch.prefs.in to this dir. Patching prefs.in file by command: </p>
      <p># cd dir_with_avidemux2_src<br>
      # patch -p0 < patch.prefs.in</p>

      <p>These patch is needed for save avsfilter parameters. Your avsfilter
      don't store parameters without this patch. Compile avidemux2 (Run configure ; make ; make install , etc) If compile success, you should be change avsfilter <em><strong>Makefile</strong></em> - add <strong>-DPREFSINCHANGE</strong> to <strong>DEFINES</strong> var line.</p></li>

<li><p>If you use binary avidemux2, avsfilter can't be save avsfilter parameters. Howewer, you can save project in avidemux2 after adds all filters. Project save all filter parameters, and parameters for avsfilter also save and restore to/from projectfile.</p></li>
<li><p>Type `make' to compile the package.</p></li>
<li><p>You can remove the program binaries and object files from the source code directory by typing `make clean'.</p></li>
</ol>
<h2>Compile wine sources [avsload.exe and pipe_source.dll] :</h2>
<ol>
  <li><p>Wine sources are compiled more complex, but overcome. Unpack filterXXX.tar.bz2 and go to win32 directory</p></li>
  <li><p>Edit variables <strong>BIN_PATH</strong> and set them to msvc binary path. These directory is containing cl.exe, link.exe and other msvc binary application. I tried to work with msvc 6.0 and other version also must be work.</p></li>
  <li><p>Edit variables <strong>WINE</strong> for wine binary pathname (check it with <strong>whereis wine</strong> command). </p></li>
  <li><p>Edit variables <strong>AVISYNTH_SRCPATH</strong> to the root of avisynth sources (contain <strong>distrib, filtersdk, src</strong> directories).</p></li>
  <li><p>Edit variables <strong>INCLUDE_PATH and LIB_PATH</strong> to the msvc include and library.</p></li>
  <li><p>Type `make' to compile the package.</p></li>
  <li><p>Copy avsload.exe and pipe_source.dll to wine directory c:\windows\system32 or other directory with wine/windows system dll's. Use winepath for check accessibility of wine pathname :<br>
<pre># winepath -w .<br># winepath -w /home/user/.wine/drive_c/wine_app/avsload.exe<br></pre> winepath return windows-like path/filenames for directory/file<br></p></li>
  <li><p>You can remove the program binaries and object files from the source code directory by typing `make clean'.</p></li>
</ol>

<A name="download_section">
<h1>Download</h1></A>
<hr>
<table>
  <tbody>
    <tr>
      <td>Latest Linux and Wine application sources</td>
      <td><A href="src/filter.src.05.03.2009.tar.bz2"><p> filter.src.05.03.2009.tar.bz2 </p></A></td>
    </tr>
    <tr>
      <td>Latest Wine application binary</td>
      <td><A href="src/avsload_pipe_binary.tar.bz2"><p> avsload_pipe_binary.tar.bz2 </p></A></td>
    </tr>
  </tbody>
</table>
<A href="index.html"><IMG src="pic/back.png" alt="Back" width="105" height="55" align="left" border="0"></A>
</body>
</html>